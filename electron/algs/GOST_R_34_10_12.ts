import { red, green } from "colors";
import { bint, BN, NB } from "types";
import { PythonShell } from "python-shell";
import { generateHash } from "../helper/hash";
import { textToNums } from "../helper/text";
import { ALPHABET, BIGTEXTVAR1 } from "../helper/globals";

function main(variables:any){
  const ghostShell = new PythonShell('./electron/algs/GOST_R_34_10_12/gost.py')

  ghostShell.send(JSON.stringify(Object.assign({}, variables, {type:'sign'})))

  ghostShell.on('message', message =>{
    if (message.length > 5){
      console.log(green('Подписанное сообщение: ') + message)
    }
    else{
      console.log(green('Верно ли оно: ') + message + '\n')
    }
  })
  
  ghostShell.end(err =>{
    if (err){
      throw err;
    };
  })
}

let gostTest = {
  p:'57896044618658097711785492504343953926634992332820282019728792003956564821041',
  a:'7',
  b:'43308876546767276905765904595650931995942111794451039583252968842033849580414',
  x:'2',
  y:'4018974056539037503335449422937059775635739389905545080690979365213431566280',
  q:'57896044618658097711785492504343953927082934583725450622380973592137631069619',
  key:'55441196065363246126355624130324183196576709222340016572108097750006097525544',
  message:'20798893674476452017134061561508270130637142515379653289952617252661468872421',
  k:'53854137677348463731403841147996619241504003434302020712960838528893196233395',
  q_x:'57520216126176808443631405023338071176630104906313632182896741342206604859403',
  q_y:'17614944419213781543809391949654080031942662045363639260709847859438286763994'
}

let testVar = {
  p:'57896044618658097711785492504343953926634992332820282019728792003956564821041',
  a:'7',
  b:'43308876546767276905765904595650931995942111794451039583252968842033849580414',
  x:'2',
  y:'4018974056539037503335449422937059775635739389905545080690979365213431566280',
  q:'57896044618658097711785492504343953927082934583725450622380973592137631069619',
  key:'55441196065363246126355624130324183196576709222340016572108097750006097525544',
  message:generateHash(textToNums(BIGTEXTVAR1, ALPHABET)),
  k:'53854137677348463731403841147996619241504003434302020712960838528893196233395',
  q_x:'57520216126176808443631405023338071176630104906313632182896741342206604859403',
  q_y:'17614944419213781543809391949654080031942662045363639260709847859438286763994'
}

main(gostTest)

main(testVar)